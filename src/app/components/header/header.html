<header class="header">
  <div class="header-left">
    <div class="logo" (click)="go('home')">
      <div class="logo-icon">
        <svg width="24" height="24" viewBox="0 0 64 64" fill="currentColor">
          <path d="M48.5 27.5A9.5 9.5 0 0 0 31 20a11 11 0 0 0-20 6 8 8 0 0 0 .5 16h36a8 8 0 0 0 1-16z"/>
        </svg>
      </div>
      <div class="brand">
        <span class="brand-name">Cloud IDE</span>
        <span class="brand-sub">code · run · share</span>
      </div>
    </div>
  </div>

  <div class="header-center">
    <nav class="nav">
      <button class="nav-btn" (click)="go('explore')" [class.active]="false">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"/>
        </svg>
        <span>Explorar</span>
      </button>
    </nav>
  </div>

  <div class="header-right">
    <!-- Auth Button - Não logado -->
    <div class="auth-buttons" *ngIf="!isAuthenticated">
      <button class="btn-primary" (click)="onAuth()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        <span>Entrar</span>
      </button>
    </div>

    <!-- User Menu - Logado -->
    <div class="user-menu-container" *ngIf="isAuthenticated" (document:click)="onDocumentClick($event)">
      <button class="user-button" (click)="toggleUserMenu()" [class.active]="showUserMenu">
        <div class="user-avatar">
          {{ getUserInitials() }}
        </div>
        <div class="user-info">
          <span class="user-name">{{ getUserDisplayName() }}</span>
          <span class="user-role" *ngIf="getRoleBadge()" [class]="getRoleColor()">
            {{ getRoleBadge() }}
          </span>
        </div>
        <svg class="chevron" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" 
             [class.rotated]="showUserMenu">
          <path d="M7 10l5 5 5-5z"/>
        </svg>
      </button>

      <!-- Dropdown Menu -->
      <div class="user-dropdown" [class.show]="showUserMenu">
        <div class="dropdown-header">
          <div class="user-avatar-large">
            {{ getUserInitials() }}
          </div>
          <div class="user-details">
            <span class="display-name">{{ getUserDisplayName() }}</span>
            <span class="user-email" *ngIf="currentUser?.userId">{{ currentUser!.userId }}</span>
            <span class="role-badge" *ngIf="getRoleBadge()" [class]="getRoleColor()">
              {{ getRoleBadge() }}
            </span>
          </div>
        </div>

        <div class="dropdown-divider"></div>

        <div class="dropdown-section">
          <button class="dropdown-item" (click)="go('profile')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <span>Meu Perfil</span>
          </button>

          <button class="dropdown-item" (click)="go('settings')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.65l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.03 7.03 0 0 0-1.62-.94l-.36-2.54A.5.5 0 0 0 12.9 2h-3.8a.5.5 0 0 0-.5.42l-.36 2.54c-.58.24-1.12.56-1.62.94l-2.39-.96a.5.5 0 0 0-.6.22L2.71 8.78a.5.5 0 0 0 .12.65l2.03 1.58c-.04.31-.06.63.06.94s.02.63.06.94L2.83 15.7a.5.5 0 0 0-.12.65l1.92 3.32c.14.24.43.34.68.25l2.39-.96c.5.38 1.04.7 1.62.94l.36 2.54c.04.28.27.42.5.42h3.8c.23 0 .46-.14.5-.42l.36-2.54c.58-.24 1.12-.56 1.62-.94l2.39.96c.25.1.54 0 .68-.25l1.92-3.32a.5.5 0 0 0-.12-.65l-2.03-1.58zM12 15.5A3.5 3.5 0 1 1 12 8.5a3.5 3.5 0 0 1 0 7z"/>
            </svg>
            <span>Configurações</span>
          </button>
        </div>

        <div class="dropdown-divider"></div>

        <div class="dropdown-section">
          <button class="dropdown-item logout" (click)="onLogout()" [disabled]="isLoggingOut">
            <svg *ngIf="!isLoggingOut" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5z"/>
            </svg>
            <svg *ngIf="isLoggingOut" class="loading-spinner" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6z"/>
            </svg>
            <span>{{ isLoggingOut ? 'Saindo...' : 'Sair' }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>